<div class="sidebar-content">
  {%- comment -%}
  Role-based navigation section
  {%- endcomment -%}
  {%- if page.url == "/" -%}
  <div class="sidebar-section">
    <h3 class="sidebar-heading">Quick Start</h3>
    <div class="role-selector">
      <label for="role-select" class="sr-only">Select your role</label>
      <select id="role-select" class="role-dropdown">
        <option value="">Choose your role...</option>
        <option value="developer">üë©‚Äçüíª Developer</option>
        <option value="architect">üèóÔ∏è Architect</option>
        <option value="devops">üîß DevOps Engineer</option>
        <option value="qa">üß™ QA Engineer</option>
        <option value="manager">üëî Engineering Manager</option>
      </select>
    </div>
    
    <div id="role-navigation" class="role-navigation" style="display: none;">
      <h4 class="role-title"></h4>
      <ul class="role-links"></ul>
    </div>
  </div>
  {%- endif -%}

  {%- comment -%}
  Current section navigation
  {%- endcomment -%}
  {%- assign current_section = page.url | split: '/' | first -%}
  {%- if current_section != "" and current_section != "index.html" -%}
  <div class="sidebar-section">
    <h3 class="sidebar-heading">
      {%- assign section_meta = site.data.navigation.categories[current_section] -%}
      {%- if section_meta -%}
      <span class="section-icon" style="background-color: {{ section_meta.color }}">
        <svg width="16" height="16" viewBox="0 0 24 24">
          <use href="#icon-{{ section_meta.icon }}"></use>
        </svg>
      </span>
      {{ section_meta.title }}
      {%- else -%}
      Current Section
      {%- endif -%}
    </h3>
    
    {%- assign section_pages = site.pages | where_exp: "p", "p.url contains current_section" | sort: "url" -%}
    {%- if section_pages.size > 0 -%}
    <nav class="section-nav">
      <ul class="nav-list">
        {%- for nav_page in section_pages -%}
        {%- unless nav_page.url contains '/assets/' or nav_page.url contains '404' -%}
        <li class="nav-item {%- if nav_page.url == page.url -%} active{%- endif -%}">
          <a href="{{ nav_page.url | relative_url }}" class="nav-link">
            {%- if nav_page.url == page.url -%}
            <svg class="nav-icon active-icon" width="12" height="12" viewBox="0 0 12 12">
              <path d="M6 2L2 6h8z"/>
            </svg>
            {%- endif -%}
            {{ nav_page.title | default: nav_page.name | remove: '.md' | replace: '-', ' ' | capitalize }}
          </a>
          
          {%- comment -%}
          Show subsections if this is the current page or a parent
          {%- endcomment -%}
          {%- if nav_page.url == page.url or page.url contains nav_page.url -%}
          {%- assign subsections = content | split: '<h2' -%}
          {%- if subsections.size > 1 -%}
          <ul class="sub-nav">
            {%- for section in subsections offset: 1 -%}
            {%- assign heading = section | split: '>' | first | split: 'id="' | last | split: '"' | first -%}
            {%- if heading != section -%}
            <li class="sub-nav-item">
              <a href="#{{ heading }}" class="sub-nav-link">{{ heading | replace: '-', ' ' | capitalize }}</a>
            </li>
            {%- endif -%}
            {%- endfor -%}
          </ul>
          {%- endif -%}
          {%- endif -%}
        </li>
        {%- endunless -%}
        {%- endfor -%}
      </ul>
    </nav>
    {%- endif -%}
  </div>
  {%- endif -%}

  {%- comment -%}
  Practice areas overview
  {%- endcomment -%}
  <div class="sidebar-section">
    <h3 class="sidebar-heading">Practice Areas</h3>
    <nav class="practice-nav">
      <div class="practice-grid">
        {%- for item in site.data.navigation.main -%}
        {%- if item.sublinks -%}
        {%- for subitem in item.sublinks -%}
        {%- assign is_current = false -%}
        {%- if page.url contains subitem.url -%}
        {%- assign is_current = true -%}
        {%- endif -%}
        <a href="{{ subitem.url | relative_url }}" class="practice-item {%- if is_current -%} current{%- endif -%}">
          <div class="practice-icon">
            <svg width="16" height="16" viewBox="0 0 24 24">
              <use href="#icon-{{ subitem.icon }}"></use>
            </svg>
          </div>
          <div class="practice-info">
            <div class="practice-title">{{ subitem.title }}</div>
            <div class="practice-desc">{{ subitem.description | truncate: 50 }}</div>
          </div>
        </a>
        {%- endfor -%}
        {%- endif -%}
        {%- endfor -%}
      </div>
    </nav>
  </div>

  {%- comment -%}
  Quick access links
  {%- endcomment -%}
  {%- assign quick_links = site.data.navigation.quick_access | where: "frequency", "daily" -%}
  {%- if quick_links.size > 0 -%}
  <div class="sidebar-section">
    <h3 class="sidebar-heading">Daily Tools</h3>
    <div class="quick-links">
      {%- for link in quick_links -%}
      <a href="{{ link.url | relative_url }}" class="quick-link">
        <svg class="quick-link-icon" width="14" height="14" viewBox="0 0 16 16">
          <path d="M8 16A8 8 0 1 0 8 0a8 8 0 0 0 0 16zm.93-9.412l-1 4.705c-.07.34.029.533.304.533.194 0 .487-.07.686-.246l-.088.416c-.287.346-.92.598-1.465.598-.703 0-1.002-.422-.808-1.319l.738-3.468c.064-.293.006-.399-.287-.47l-.451-.081.082-.381 2.29-.287zM8 5.5a1 1 0 1 1 0-2 1 1 0 0 1 0 2z"/>
        </svg>
        {{ link.title }}
      </a>
      {%- endfor -%}
    </div>
  </div>
  {%- endif -%}

  {%- comment -%}
  Search widget (if not on search page)
  {%- endcomment -%}
  {%- unless page.url contains 'search' -%}
  <div class="sidebar-section">
    <h3 class="sidebar-heading">Search</h3>
    <div class="sidebar-search">
      <form role="search" method="get" action="{{ '/search/' | relative_url }}">
        <div class="search-wrapper">
          <input type="search" name="q" placeholder="Search handbook..." class="search-input" />
          <button type="submit" class="search-button" aria-label="Search">
            <svg width="16" height="16" viewBox="0 0 16 16">
              <path d="M11.5 6.5a5 5 0 11-10 0 5 5 0 0110 0zm-.5 4.5a6 6 0 10-1.5 1.5L15 16.5 16.5 15l-5.5-4z"/>
            </svg>
          </button>
        </div>
      </form>
    </div>
  </div>
  {%- endunless -%}

  {%- comment -%}
  Recent updates (if available)
  {%- endcomment -%}
  {%- assign recent_pages = site.pages | where_exp: "p", "p.last_updated" | sort: "last_updated" | reverse -%}
  {%- if recent_pages.size > 0 -%}
  <div class="sidebar-section">
    <h3 class="sidebar-heading">Recent Updates</h3>
    <div class="recent-updates">
      {%- for recent_page in recent_pages limit: 5 -%}
      <a href="{{ recent_page.url | relative_url }}" class="recent-item">
        <div class="recent-title">{{ recent_page.title | truncate: 30 }}</div>
        <div class="recent-date">{{ recent_page.last_updated | date: "%b %d" }}</div>
      </a>
      {%- endfor -%}
    </div>
  </div>
  {%- endif -%}

  {%- comment -%}
  Contribution CTA
  {%- endcomment -%}
  <div class="sidebar-section sidebar-cta">
    <div class="cta-content">
      <h4 class="cta-title">Improve This Handbook</h4>
      <p class="cta-description">Help make this resource better for everyone.</p>
      <div class="cta-actions">
        <a href="{{ '/contributing/' | relative_url }}" class="cta-button primary">
          <svg width="16" height="16" viewBox="0 0 16 16">
            <path d="M11.013 1.427a1.75 1.75 0 012.474 0l1.086 1.086a1.75 1.75 0 010 2.474l-8.61 8.61c-.21.21-.47.364-.756.445l-3.251.93a.75.75 0 01-.927-.928l.929-3.25a1.75.75 0 01.445-.758l8.61-8.61z"/>
          </svg>
          Contribute
        </a>
        {%- if site.github.issues_url -%}
        <a href="{{ site.github.issues_url }}/new" class="cta-button secondary" target="_blank" rel="noopener">
          <svg width="16" height="16" viewBox="0 0 16 16">
            <path d="M8 1.5c-2.363 0-4 1.69-4 3.75 0 .984.424 1.625.984 2.304l.214.253c.223.264.47.556.673.848.284.411.537.896.621 1.49a.75.75 0 01-1.484.211c-.04-.282-.163-.547-.37-.847a8.695 8.695 0 00-.542-.68c-.084-.1-.173-.205-.268-.32C3.201 7.75 2.5 6.766 2.5 5.25 2.5 2.31 4.863 0 8 0s5.5 2.31 5.5 5.25c0 1.516-.701 2.5-1.328 3.259-.095.115-.184.22-.268.319-.207.245-.383.453-.541.681-.208.3-.33.565-.37.847a.75.75 0 01-1.485-.212c.084-.593.337-1.078.621-1.489.203-.292.45-.584.673-.848.075-.088.147-.173.213-.253.561-.679.985-1.32.985-2.304 0-2.06-1.637-3.75-4-3.75z"/>
          </svg>
          Report Issue
        </a>
        {%- endif -%}
      </div>
    </div>
  </div>
</div>

<script>
// Role-based navigation functionality
document.addEventListener('DOMContentLoaded', function() {
  const roleSelect = document.getElementById('role-select');
  const roleNavigation = document.getElementById('role-navigation');
  const roleTitle = document.querySelector('.role-title');
  const roleLinks = document.querySelector('.role-links');
  
  const roleData = {
    developer: {{ site.data.navigation.roles.developer | jsonify }},
    architect: {{ site.data.navigation.roles.architect | jsonify }},
    devops: {{ site.data.navigation.roles.devops | jsonify }},
    qa: {{ site.data.navigation.roles.qa | jsonify }},
    manager: {{ site.data.navigation.roles.manager | jsonify }}
  };
  
  if (roleSelect) {
    roleSelect.addEventListener('change', function() {
      const selectedRole = this.value;
      
      if (selectedRole && roleData[selectedRole]) {
        const data = roleData[selectedRole];
        roleTitle.textContent = data.title;
        
        roleLinks.innerHTML = '';
        data.priority_areas.forEach(function(area) {
          const li = document.createElement('li');
          li.className = 'role-link-item priority-' + area.priority;
          
          const a = document.createElement('a');
          a.href = area.url;
          a.className = 'role-link';
          a.textContent = area.title;
          
          const priority = document.createElement('span');
          priority.className = 'priority-badge';
          priority.textContent = area.priority;
          
          a.appendChild(priority);
          li.appendChild(a);
          roleLinks.appendChild(li);
        });
        
        roleNavigation.style.display = 'block';
      } else {
        roleNavigation.style.display = 'none';
      }
    });
  }
  
  // Smooth scroll for anchor links
  document.querySelectorAll('a[href^="#"]').forEach(function(link) {
    link.addEventListener('click', function(e) {
      const target = document.querySelector(this.getAttribute('href'));
      if (target) {
        e.preventDefault();
        target.scrollIntoView({ 
          behavior: 'smooth',
          block: 'start'
        });
      }
    });
  });
});
</script>

<style>
.sidebar {
  background-color: #f8f9fa;
  border-right: 1px solid #dee2e6;
  padding: 1.5rem 1rem;
  position: sticky;
  top: 120px;
  max-height: calc(100vh - 140px);
  overflow-y: auto;
  scrollbar-width: thin;
  scrollbar-color: #cbd5e0 transparent;
}

.sidebar::-webkit-scrollbar {
  width: 6px;
}

.sidebar::-webkit-scrollbar-track {
  background: transparent;
}

.sidebar::-webkit-scrollbar-thumb {
  background-color: #cbd5e0;
  border-radius: 3px;
}

.sidebar-content {
  display: flex;
  flex-direction: column;
  gap: 2rem;
}

.sidebar-section {
  margin-bottom: 1.5rem;
}

.sidebar-heading {
  font-size: 1rem;
  font-weight: 600;
  color: #2c3e50;
  margin: 0 0 0.75rem 0;
  padding-bottom: 0.5rem;
  border-bottom: 2px solid #e9ecef;
  display: flex;
  align-items: center;
  gap: 0.5rem;
}

.section-icon {
  width: 20px;
  height: 20px;
  border-radius: 4px;
  display: flex;
  align-items: center;
  justify-content: center;
}

.role-selector {
  margin-bottom: 1rem;
}

.role-dropdown {
  width: 100%;
  padding: 0.5rem;
  border: 1px solid #dee2e6;
  border-radius: 0.25rem;
  background-color: white;
  font-size: 0.9rem;
}

.role-navigation {
  background-color: white;
  border-radius: 0.375rem;
  padding: 1rem;
  border: 1px solid #e9ecef;
}

.role-title {
  font-size: 0.9rem;
  font-weight: 600;
  color: #3498db;
  margin: 0 0 0.75rem 0;
}

.role-links {
  list-style: none;
  padding: 0;
  margin: 0;
}

.role-link-item {
  margin-bottom: 0.5rem;
}

.role-link {
  display: flex;
  justify-content: space-between;
  align-items: center;
  text-decoration: none;
  color: #2c3e50;
  font-size: 0.85rem;
  padding: 0.4rem 0.6rem;
  border-radius: 0.25rem;
  transition: all 0.2s ease;
}

.role-link:hover {
  background-color: #f8f9fa;
  color: #3498db;
}

.priority-badge {
  font-size: 0.7rem;
  text-transform: uppercase;
  padding: 0.15rem 0.35rem;
  border-radius: 0.2rem;
  font-weight: 500;
  letter-spacing: 0.5px;
}

.priority-high .priority-badge {
  background-color: #fee2e2;
  color: #dc2626;
}

.priority-medium .priority-badge {
  background-color: #fef3cd;
  color: #d97706;
}

.priority-low .priority-badge {
  background-color: #d1fae5;
  color: #059669;
}

.nav-list {
  list-style: none;
  padding: 0;
  margin: 0;
}

.nav-item {
  margin-bottom: 0.25rem;
}

.nav-link {
  display: flex;
  align-items: center;
  gap: 0.5rem;
  text-decoration: none;
  color: #4a5568;
  font-size: 0.9rem;
  padding: 0.4rem 0.75rem;
  border-radius: 0.25rem;
  transition: all 0.2s ease;
}

.nav-item.active .nav-link {
  background-color: #3498db;
  color: white;
  font-weight: 500;
}

.nav-link:hover {
  background-color: #e2e8f0;
  color: #2c3e50;
}

.nav-item.active .nav-link:hover {
  background-color: #2980b9;
  color: white;
}

.active-icon {
  fill: currentColor;
}

.sub-nav {
  list-style: none;
  padding: 0;
  margin: 0.5rem 0 0 1.5rem;
}

.sub-nav-item {
  margin-bottom: 0.15rem;
}

.sub-nav-link {
  display: block;
  text-decoration: none;
  color: #6c757d;
  font-size: 0.8rem;
  padding: 0.2rem 0.5rem;
  border-radius: 0.2rem;
  transition: all 0.2s ease;
}

.sub-nav-link:hover {
  color: #3498db;
  background-color: #f8f9fa;
}

.practice-grid {
  display: flex;
  flex-direction: column;
  gap: 0.5rem;
}

.practice-item {
  display: flex;
  align-items: center;
  gap: 0.75rem;
  text-decoration: none;
  color: #2c3e50;
  padding: 0.75rem;
  border-radius: 0.375rem;
  transition: all 0.2s ease;
  border: 1px solid transparent;
}

.practice-item:hover {
  background-color: white;
  border-color: #e9ecef;
  transform: translateX(2px);
}

.practice-item.current {
  background-color: #e3f2fd;
  border-color: #3498db;
}

.practice-icon {
  width: 28px;
  height: 28px;
  background-color: #f8f9fa;
  border-radius: 0.25rem;
  display: flex;
  align-items: center;
  justify-content: center;
  flex-shrink: 0;
}

.practice-info {
  flex: 1;
  min-width: 0;
}

.practice-title {
  font-size: 0.85rem;
  font-weight: 500;
  color: #2c3e50;
  margin-bottom: 0.1rem;
}

.practice-desc {
  font-size: 0.75rem;
  color: #6c757d;
  line-height: 1.3;
}

.quick-links {
  display: flex;
  flex-direction: column;
  gap: 0.4rem;
}

.quick-link {
  display: flex;
  align-items: center;
  gap: 0.5rem;
  text-decoration: none;
  color: #3498db;
  font-size: 0.85rem;
  padding: 0.4rem 0.6rem;
  border-radius: 0.25rem;
  border: 1px solid #e3f2fd;
  transition: all 0.2s ease;
}

.quick-link:hover {
  background-color: #e3f2fd;
  border-color: #3498db;
}

.quick-link-icon {
  fill: currentColor;
  flex-shrink: 0;
}

.sidebar-search {
  margin-bottom: 1rem;
}

.search-wrapper {
  position: relative;
}

.search-input {
  width: 100%;
  padding: 0.5rem 2.5rem 0.5rem 0.75rem;
  border: 1px solid #dee2e6;
  border-radius: 0.375rem;
  font-size: 0.85rem;
  background-color: white;
}

.search-input:focus {
  outline: none;
  border-color: #3498db;
  box-shadow: 0 0 0 2px rgba(52, 152, 219, 0.1);
}

.search-button {
  position: absolute;
  right: 0.5rem;
  top: 50%;
  transform: translateY(-50%);
  background: none;
  border: none;
  cursor: pointer;
  padding: 0.25rem;
  border-radius: 0.2rem;
  display: flex;
  align-items: center;
  justify-content: center;
}

.search-button:hover {
  background-color: #f8f9fa;
}

.search-button svg {
  fill: #6c757d;
}

.recent-updates {
  display: flex;
  flex-direction: column;
  gap: 0.5rem;
}

.recent-item {
  display: flex;
  justify-content: space-between;
  align-items: flex-start;
  text-decoration: none;
  padding: 0.5rem 0.75rem;
  border-radius: 0.25rem;
  transition: all 0.2s ease;
}

.recent-item:hover {
  background-color: white;
}

.recent-title {
  font-size: 0.8rem;
  color: #2c3e50;
  line-height: 1.3;
}

.recent-date {
  font-size: 0.7rem;
  color: #6c757d;
  white-space: nowrap;
  margin-left: 0.5rem;
}

.sidebar-cta {
  background-color: white;
  border-radius: 0.5rem;
  padding: 1.25rem;
  border: 1px solid #e9ecef;
  text-align: center;
}

.cta-content {
  display: flex;
  flex-direction: column;
  gap: 0.75rem;
}

.cta-title {
  font-size: 0.9rem;
  font-weight: 600;
  color: #2c3e50;
  margin: 0;
}

.cta-description {
  font-size: 0.8rem;
  color: #6c757d;
  margin: 0;
  line-height: 1.4;
}

.cta-actions {
  display: flex;
  flex-direction: column;
  gap: 0.5rem;
}

.cta-button {
  display: flex;
  align-items: center;
  justify-content: center;
  gap: 0.4rem;
  text-decoration: none;
  font-size: 0.8rem;
  font-weight: 500;
  padding: 0.5rem 0.75rem;
  border-radius: 0.25rem;
  transition: all 0.2s ease;
}

.cta-button.primary {
  background-color: #3498db;
  color: white;
}

.cta-button.primary:hover {
  background-color: #2980b9;
}

.cta-button.secondary {
  background-color: #f8f9fa;
  color: #6c757d;
  border: 1px solid #dee2e6;
}

.cta-button.secondary:hover {
  background-color: #e9ecef;
  color: #495057;
}

.cta-button svg {
  fill: currentColor;
}

.sr-only {
  position: absolute;
  width: 1px;
  height: 1px;
  padding: 0;
  margin: -1px;
  overflow: hidden;
  clip: rect(0, 0, 0, 0);
  white-space: nowrap;
  border: 0;
}

@media (max-width: 1024px) {
  .sidebar {
    position: static;
    max-height: none;
    background-color: white;
    border-right: none;
    border-top: 1px solid #dee2e6;
    padding: 1rem;
  }
  
  .sidebar-content {
    gap: 1.5rem;
  }
  
  .practice-grid {
    display: grid;
    grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
    gap: 0.75rem;
  }
  
  .cta-actions {
    flex-direction: row;
  }
}

@media (max-width: 640px) {
  .practice-grid {
    grid-template-columns: 1fr;
  }
  
  .cta-actions {
    flex-direction: column;
  }
}
</style>